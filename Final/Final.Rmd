---
title: "An Evaluation of Salary, Promotion, and Hiring Process at Black Saber Software"
subtitle: "Evidence of Gender Bias in Salary"
author: "Report prepared for Black Saber Software by Calabash Brothers Solutions"
date: 2021-04-21
lang: "en"
output:
  pdf_document:
    template: report.tex
    toc: true
    toc_depth: 2
titlepage: true
titlepage-color: "6C3082"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
---

```{r, message = FALSE, echo=FALSE}
library(tidyverse)
# this should supress all code and messages
knitr::opts_chunk$set(include=FALSE)
```


\newpage
# Executive summary

_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All three research questions are addressed_


\newpage
# Technical report
_This part of the report is much more comprehensive than the executive summary. The audience is statistics/data-minded people, but you should NOT include code or unformatted R output here._


## Introduction

### Over the past few months, several companies in software have had bad press on people having complaints about their salaries, applicants having concerns about potenial bias in the hiring process. Chief People Officer | Black Saber Software had hired us and provided us with hiring data for new grad program, and data about promotion and salary for the entire staff. The report is to investigate whether there is potential bias in the hiring and remuneration processes, and to ensure that the company is out ahead of any potential issues.


### Research questions
_Use bullet points to to describe the research questions you are going to address. Write in full sentences._

## Informative title for section addressing a research question

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

```{r}
# This chunk provides an example of some things you can do with RMarkdown to make your report creation process easier

# read in the data
cemployees <- read_csv("data/black-saber-current-employees.csv")
phase1 <- read_csv("data/phase1-new-grad-applicants-2020.csv")
phase2 <- read_csv("data/phase2-new-grad-applicants-2020.csv")
phase3 <- read_csv("data/phase3-new-grad-applicants-2020.csv")
final_hire <- read_csv("data/final-hires-newgrad_2020.csv")


# create a visualization
my_plot <- cemployees %>% 
  ggplot(aes(x = productivity)) +
  geom_histogram(colour = "grey", fill = "#6C3082") +
  theme_minimal() +
  labs(title = "Look! A title. But do you want a title or a caption for your report?", x = "This is a changed x label")
# save your plot in your images folder, you can specify the height and width, too
# saving this means you can add the image to your exectuve summary without having to run or rerun the code, if you wish
ggsave("images/example.png", width = 7, height = 4)

# norice how the image is included with the ![](file/path.png) below
```

![](images/example.png)
z
## Informative title for section addressing a research question
## Informative title for section addressing a research question

```{r, include = FALSE}
library(tidyverse)
library(lme4)
install.packages("ggmosaic")
library(ggmosaic)
library(knitr)
install.packages("kableExtra")
library(kableExtra)
```

## Research Question 1: Is gender bias involved in the process of three-phases recruitment?

It is known that the recruitment process in Black Saber Software Company consists of three phases, so our examination of fairness of the hiring process will be focusing on analyzing hiring data in each phase respectively. By using the provided data sets containing information for applicants, we can construct statistical model (Logistics Regression in this report) using gender and other covariates to explain the probability of a given applicant being selected in each phase. Whether of not gender bias exists can be checked by its significance in the model we construct. This is the general methodology that we use to resolve this question. We will now go through the detailed process of model constructing for each phase as follows.

### Phase 1 $\rightarrow$ Phase 2
We start by left joining applicants data in phase 2 into phase 1 by using function `left_join` in the `tidyverse` package in R with applicant ID and add binary variable `pass_phase1` to indicate whether the applicant is selected to the next phase. \newline

In order to build model, some exploratory data analysis is performed as follows. Note that Figure 1 is the visualization for the contingency table that represents the proportion of applicants in each gender that are selected to the next phase. It can be seen that the proportion of men and women that are selected to the next phase is roughly the same. Out of those who apply for data team, `r 132/(124+132)` are selected and out of those who apply for software tea,`168/(168+189)` applicants are selected to move on. Figure 2 compares the proportion of applicants who are selected by their gender and the team they apply to work with. The plot suggests that for each gender group, their is a slightly higher proportion of acceptance if the applicant is willing to work in the data team compared to the software team. Therefore, a term for the team that applicants want to apply for will be considered in our model and it actually serves as the random effect in our model. It is also worth noting that no obvious difference can be observed between men and women group, which also agree with our previous plot. \newline

We start by building the logistic mixed effect model written as follows:
$$\log(\frac{p}{1-p}) = $$



## Research Question 2: Is there any gender bias in the remuneration processes?
Black Saber Software provide us with data about promotion and salary for the entire staff. The data we get consists information of the staff including annual salary, gender, job in the company, financial quarter salary, productivity, role seniority, and quality of demonstrated leadership. We use these data to investigate whether there is any gender bias in remuneration process. The general methodology that we use to is creating a boxplot of salary conditions on role seniority and gender setting, and then applying different types of regression models to see which one best serve our purpose. 
Boxplot: 





From the graph, we can see that women have lower salaries across different role seniority.

In order to test whether gender bias truely exists, we need to first find the most appropriate model. We create a simple linear regression model: $$y = x1+x$$, we find out that gender is statistically significant, which suggests gender has impacts on salaries. Moving on from SLR, we apply linear mixed model: $$ y =    $$, we add the variable "team"(job in the company) as the random intercept. We do such because we think there should be variations in salaries across different jobs in the company. The likelihood ratio test tells us including such does explain the data better. The results from the linear mixed model also show us that gender is significant. Next, we add a random slope to the previous model because the effect of the productivity may be different for different jobs in the company. After the likelihood ratio test, we find that slopes are an unnecessary complication to our model. Finally, we add role seniority as another random intercept because there should be variations in the salaries across different role seniority based on our histogram. For example, senior workers have higher salaries than junior workers. The likelihood ratio test tells us that including this random intercept does explain the model better. Thus, the final model is $$     $$. 
$$   $$
Based on interpretation, Woman has lower salary by an average of $\$1758$ than man. This result indicates that there is gender bias in remuneration. 





```{r}
## Phase 1 -> Phase 2
## Join Phase 1 and Phase 2, create variable pass_phase1
joint12 <- phase1 %>% left_join(phase2, by= c("applicant_id", "team_applied_for", "cover_letter","cv", "gpa", "gender", "extracurriculars", "work_experience")) %>% mutate(pass_phase1 = ifelse(is.na(technical_skills), 0, 1))

## Draw Contingency Table
table(factor(joint12$team_applied_for), factor(joint12$pass_phase1))

## Visualize Contingency Table
joint12 %>% ggplot() + geom_mosaic(aes(x = product(gender, pass_phase1), fill = gender))

proptable5 <- joint12 %>% group_by(gender, team_applied_for, pass_phase1) %>% summarize(number = n()) %>% group_by(gender, team_applied_for) %>% summarize(pass_phase1 = pass_phase1, ratio = number/sum(number))
ggplot(proptable5, aes(fill = factor(pass_phase1), y = ratio, x = team_applied_for)) + geom_bar(position = "fill", stat = "identity")+facet_grid(. ~ gender)


## Build Mixed Logistic regression model to explain whether or not phase 1 is passed
joint12$team_applied_for <- as.factor(joint12$team_applied_for)
model1 <- glmer(pass_phase1 ~ gpa + extracurriculars + work_experience + gender
                + (1|team_applied_for), family = "binomial", data = joint12)
summary(model1)
## Calculate CI
ci <- confint(model1)
## Print Result of Regression
table <- cbind(round(exp(summary(model1)$coeff[,1]),2),
               round(exp(ci[-1, ]), 2),
               round(summary(model1)$coeff[,4],4))
colnames(table) <- c("Estimate", "Lower Limit", "Upper Limit", "p-value")
kable(table)
```

```{r}
## Phase 2 -> Phase 3
## Join phase2 and phase3 data and create variable pass_phase2
joint23 <- phase2 %>% left_join(phase3, by = "applicant_id") %>% mutate(pass_phase2 = ifelse(is.na(interviewer_rating_1), 0, 1))

## Visualization for exploratory data analysis
proptable2 <- table(factor(joint23$gender), factor(joint23$pass_phase2))
proptable2 <- as.data.frame(prop.table(proptable2, 1))
names(proptable2)[1]=('Gender')
names(proptable2)[2]=('Pass')
names(proptable2)[3]=("Proportion")
ggplot(data=proptable2, aes(x=Gender, y=Proportion, fill=Pass)) + geom_bar(stat="identity") 


proptable3 <- joint23 %>% group_by(gender, team_applied_for, pass_phase2) %>% summarize(number = n()) %>% group_by(gender, team_applied_for) %>% summarize(pass_phase2 = pass_phase2, ratio = number/sum(number))
ggplot(proptable3, aes(fill = factor(pass_phase2), y = ratio, x = team_applied_for)) + geom_bar(position = "fill", stat = "identity")+facet_grid(. ~ gender)

## Build Mixed Logistic regression model to explain whether or not phase 2 is passed
model2 <- glm(pass_phase2 ~ gender + gpa + technical_skills + writing_skills + leadership_presence + speaking_skills + team_applied_for, family = "binomial", data = joint23)
summary(model2)

model3 <- glm(pass_phase2 ~ gender + gpa + technical_skills + writing_skills + leadership_presence + speaking_skills, family = "binomial", data = joint23)
summary(model3)

model4 <- glm(pass_phase2 ~ gender + technical_skills + writing_skills + leadership_presence + speaking_skills, family = "binomial", data = joint23)
summary(model4)

drop_in_dev <- anova(model4, model3, model2, test="Chisq")

## Calculate CI
ci2 <- confint(model2)
## Print Result of Regression
table2 <- cbind(round(exp(summary(model2)$coeff[,1]),2),
               round(exp(ci2[-1, ]), 2),
               round(summary(model2)$coeff[,4],4))
colnames(table2) <- c("Estimate", "Lower Limit", "Upper Limit", "p-value")
kable(table2)
```

```{r}
## Phase 3 -> Final Result
final_hire <- final_hire %>% mutate(pass_phase3 = 1)
joint3f <- joint23 %>% filter(is.na(interviewer_rating_1)==FALSE) %>% left_join(final_hire, by = "applicant_id")
joint3f$pass_phase3[is.na(joint3f$pass_phase3)] <- 0 

proptable4 <- table(factor(joint3f$gender), factor(joint3f$pass_phase3))
proptable4 <- as.data.frame(prop.table(proptable4, 1))
names(proptable4)[1]=('Gender')
names(proptable4)[2]=('Pass')
names(proptable4)[3]=("Proportion")
ggplot(data=proptable4, aes(x=Gender, y=Proportion, fill=Pass)) + geom_bar(stat="identity") 
joint3f %>% ggplot() + geom_mosaic(aes(x = product(gender, pass_phase3), fill = gender))

model5 <- glm(pass_phase_3 ~ gender + interviewer_rating_1:interviewer_rating_2, data = joint3f, family = "binomial")
summary(model5)

joint3f %>% mutate(mean = mean(interviewer_rating_1, interviewer_rating_2))
```

```{r,include=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
#chunk new created by Peter
## check if salary are fair in gender(gender)
new_cemployees =  cemployees%>%
  mutate(salary = str_remove_all(cemployees$salary,"[[:punct:]]")) %>%
  mutate(salary = as.integer(str_remove_all(cemployees$salary,"[^[:alnum:]]")))


#create a histogram of salary condition on role seniority
new_cemployees %>%
  ggplot(aes(x = salary)) +
  stat_bin(bins = 50)+
  geom_histogram() +
  facet_wrap(~role_seniority, nrow = 3) +
  ggtitle(label="Histogram of salary condition on role seniority") +
  theme_bw() +
  theme(legend.position = "right")

new_cemployees = new_cemployees%>%
  filter(gender!="Prefer not to say")%>%
  mutate(role_seniority = fct_relevel(role_seniority, "Director", after = 7))
new_cemployees = new_cemployees%>%
  mutate(role_seniority = fct_relevel(role_seniority, "Manager", after = 6))

reg_salary_1 = lm(salary~productivity, data =new_cemployees)
reg_salary_2 = lmer(salary~productivity+(1|role_seniority), data =new_cemployees)
lmtest::lrtest(reg_salary_1, reg_salary_2)#check if role seniority as random intercept(baseline) is more significant

reg_salary_3 = lmer(salary~productivity+(1|role_seniority)+(1|financial_q), data =new_cemployees)
lmtest::lrtest(reg_salary_2, reg_salary_3) #check if financial quarter as random intercept is more significant

reg_salary_4 = lmer(salary~productivity+(1|role_seniority)+(1+productivity|financial_q), data =new_cemployees)
lmtest::lrtest(reg_salary_2, reg_salary_4)
#check if check if financial quarter as random intercept and random slope are more significant
#productivity are affect by financial quarter(significant)

reg_salary_5 = lmer(salary~productivity+(1|role_seniority)+(1+productivity|financial_q)+(1|gender), 
                    data =new_cemployees) #final model
lmtest::lrtest(reg_salary_4, reg_salary_5) 
#check if gender as random intercept is significant
#conclusion: has gender bias

#create a boxplot
new_cemployees %>%
  ggplot(aes(x = role_seniority,
             y = salary,
             color=gender)) +
  geom_boxplot() +
  theme_minimal() +
  ggtitle(label="Salary by role seniority and gender setting") +
  theme(legend.position = "right")
```

```{r}
b = cemployees %>%
  group_by(employee_id)%>%
  count(role_seniority)
colnames(b)[3] ="time_since_promotion" 

  
```
## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations

\newpage
# Consultant information
## Consultant profiles

**Chengen Dong**. Chengen is a senior consultant with Calabash Brothers Solutions. He specializes in data visualization. Daniel earned his Bachelor of Science, Specialist in Statistics Methods and Practice, from the University of Toronto in 2024.

**Yuxuan Longt**. Yuxuan is a senior consultant with Calabash Brothers Solutions. He specialize in reproducible analysis. Peter earned their Bachelor of Science, Majoring in Statistics from the University of Toronto in 2028.

**Ran Li** Ran is a junior consultant in Calabash Brothers Solutions. She is good at coding with software like R and Python. She specializes in Computer Science. Liran earned her Bachelor of Science, Majoring in Computer Science from the University of Toronto in 2028.

**Peizhe Huang** Peizhe is a senior consultant with Calabash Brothers Solutions. She specializes in Probability Statistics. Peizhe earned their Bachelor of Science, Majoring in Statistics from the University of Toronto in 2022.

## Code of ethical conduct

#### Integrity: We maintained honest with our data and clear communication throughout the working process.

#### Teamwork: We worked together to get the job done.

#### Confidentiality: We maintained clients' condifence at all time

#### Growth: We always pursue professional growth




__Final advice: KNIT EARLY AND OFTEN!__