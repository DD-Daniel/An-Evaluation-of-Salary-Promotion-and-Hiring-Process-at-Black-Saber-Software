---
title: "An Evaluation of Salary, Promotion, and Hiring Process at Black Saber Software"
subtitle: "Evidence of Gender Bias in Salary"
author: "Report prepared for Black Saber Software by Calabash Brothers Solutions"
date: 2021-04-21
lang: "en"
output:
  pdf_document:
    template: report.tex
    toc: true
    toc_depth: 2
titlepage: true
titlepage-color: "6C3082"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
---

```{r, message = FALSE, echo=FALSE}
library(tidyverse)
# this should supress all code and messages
knitr::opts_chunk$set(include=FALSE)
```


\newpage
# Executive summary

Over the past few months, several software companies had received bad press about their hiring and remuneration processes, during which human bias are present. As a consequence, people have been raising concerns about potential bias in the recruitment and promotion process of Black Saber Software. Experts in our advisory and consulting group are hired to ensure the client company is out ahead of any potential such issues. This study following set out to assess whether the client company exhibits a bias against female in hiring, as well as 2013-2020 salary and promotion.

The results of the study are summarized below.

*The gender bias are not present in the first two rounds of the hiring process. Females and males have equal opportunities to be selected in both the first round and the second round of the recruiting. Neither men nor women are more favorable.

*In the Phase I of the recruitment process, individuals who have higher GPA or those who have demonstrated some work experience in the past are more possible to be automatically selected by the AI to the next round. However, surprisingly, young professionals who have rich extracurricular experiences do not seem to have a notifiable advantage in the first round of the hiring. 

*Only individuals who has provided sufficient material to the company, that is, only those who uploaded both CV and the cover letter are likely to pass the phase I recruiting process.

*In the Phase II of the hiring, GPA and work experience are no longer a factor that will have an effect on the selection process. Instead, the evaluation of individuals focus on  technical skills as well as other soft skills such as writing skills, speaking skills and leadership skills.

*Overall, current male employees have higher salary compared to their female counterparts who has the same role seniority under the same department. Female employees are not well-paid even if they have the same amount of workloads as male employees.


*

Key results of the study are summarized in the following tables.








_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All three research questions are addressed_


\newpage
# Technical report
_This part of the report is much more comprehensive than the executive summary. The audience is statistics/data-minded people, but you should NOT include code or unformatted R output here._


## Introduction

### Over the past few months, several companies in software have had bad press on people having complaints about their salaries, applicants having concerns about potenial bias in the hiring process. Chief People Officer | Black Saber Software had hired us and provided us with hiring data for new grad program, and data about promotion and salary for the entire staff. The report is to investigate whether there is potential bias in the hiring and remuneration processes, and to ensure that the company is out ahead of any potential issues.


### Research questions
_Use bullet points to to describe the research questions you are going to address. Write in full sentences._

## Informative title for section addressing a research question

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_

```{r}
# This chunk provides an example of some things you can do with RMarkdown to make your report creation process easier

# read in the data
cemployees <- read_csv("data/black-saber-current-employees.csv")
phase1 <- read_csv("data/phase1-new-grad-applicants-2020.csv")
phase2 <- read_csv("data/phase2-new-grad-applicants-2020.csv")
phase3 <- read_csv("data/phase3-new-grad-applicants-2020.csv")
final_hire <- read_csv("data/final-hires-newgrad_2020.csv")


# create a visualization
my_plot <- cemployees %>% 
  ggplot(aes(x = productivity)) +
  geom_histogram(colour = "grey", fill = "#6C3082") +
  theme_minimal() +
  labs(title = "Look! A title. But do you want a title or a caption for your report?", x = "This is a changed x label")
# save your plot in your images folder, you can specify the height and width, too
# saving this means you can add the image to your exectutive summary without having to run or rerun the code, if you wish
ggsave("images/example.png", width = 7, height = 4)

# notice how the image is included with the ![](file/path.png) below
```






```{r}
## Summary Table I: Current employee by department and gender in the fourth quarter of 2020
cemployees %>% group_by(team) %>% summarize(man = sum(gender == "Man"), woman = sum(gender == "Woman")) %>% mutate(total = man + woman, man_prop= man/total, woman_prop = woman/total)

```


```{r}

## Figure I: The time series plot describes the promotion rate of male employees versus the promotion rate of female employees over time. The horizontal median line in the middle of the boxes represents the point at which the promotion rate of two genders are equal.


N = nrow(cemployees)
cemployees$promotion_or_not <- seq(1:N)
cemployees$promotion_or_not[N] <- 0
names(cemployees)[2] <- "Gender"
for(i in 1:(N-1)){
  
  if((cemployees$employee_id[i] == cemployees$employee_id[i + 1]) &(cemployees$role_seniority[i] != cemployees$role_seniority[i+1])){
    cemployees$promotion_or_not[i] <- 1
  }
  
  else cemployees$promotion_or_not[i] <- 0
}


t1 <- cemployees %>% group_by(financial_q) %>%summarize(man = sum(Gender == "Man"), woman = sum(Gender == "Woman")) %>% mutate(total = man + woman, man_prop= man/total, woman_prop = woman/total)


temp <-cemployees %>% filter(promotion_or_not == 1) %>% group_by(financial_q) %>%summarize(man = sum(Gender == "Man"), woman = sum(Gender == "Woman")) %>% mutate(total = man + woman, man_prop= man/total, woman_prop = woman/total)


t2 <- t1 %>% left_join(temp, by = "financial_q")
t2$man.y[is.na(t2$man.y)]<-0
t2$woman.y[is.na(t2$woman.y)]<-0

t2 <- t2 %>% mutate(prom_ratio_man = man.y/man.x, prom_ratio_woman = woman.y/woman.x)

t2<-t2[,c(1,7,8,12,13)]
t2


t2$prom_ratio_man <- round(t2$prom_ratio_man,3)
t2$prom_ratio_woman <- round(t2$prom_ratio_woman,3)
t2 <- t2 %>% mutate(man_per = prom_ratio_man/(prom_ratio_man + prom_ratio_woman)) %>% filter(is.na(man_per) == FALSE)

t2 %>% ggplot(aes(x = financial_q,  y = man_per, group = 1)) + geom_line()+geom_hline(yintercept = 0.5, linetype = "dashed", color = "red")+theme(axis.text.x = element_text(angle = 45))

```









```{r, include = FALSE}
library(tidyverse)
library(lme4)

install.packages("ggmosaic")
library(ggmosaic)
library(knitr)
library(kableExtra)

```



## Research Question 1: Is gender bias involved in the process of three-phases recruitment?

It is known that the recruitment process in Black Saber Software Company consists of three phases, so our examination of fairness of the hiring process will be focusing on analyzing hiring data in each phase respectively. By using the provided data sets containing information for applicants, we can construct statistical model (Logistics Regression in this report) using gender and other covariates to explain the probability of a given applicant being selected in each phase. Whether of not gender bias exists can be checked by its significance in the model we construct. This is the general methodology that we use to resolve this question. We will now go through the detailed process of model constructing for each phase as follows.

### Phase 1 $\rightarrow$ Phase 2
We start by left joining applicants data in phase 2 into phase 1 by using function `left_join` in the `tidyverse` package in R with applicant ID and add binary variable `pass_phase1` to indicate whether the applicant is selected to the next phase. \newline

In order to build model, some exploratory data analysis is performed as follows. Note that Figure 1 is the visualization for the contingency table that represents the proportion of applicants in each gender that are selected to the next phase. It can be seen that the proportion of men and women that are selected to the next phase is roughly the same. Out of those who apply for data team, `r 132/(124+132)` are selected and out of those who apply for software tea,`r `168/(168+189)` applicants are selected to move on. Figure 2 compares the proportion of applicants who are selected by their gender and the team they apply to work with. The plot suggests that for each gender group, their is a slightly higher proportion of acceptance if the applicant is willing to work in the data team compared to the software team. Therefore, a term for the team that applicants want to apply for will be considered in our model. It is also worth noting that no obvious difference can be observed between men and women group, which also agree with our previous plot. \newline

Our outcome of interest is whether the applicant passes phase 1, and our predictors are GPA, work experience, extracurricular and team the applicant applies for, treated as a factor. As our outcome variable is binary, we are going to use logistic regression.The model can be written as:

$$Y_{i} \sim Bernoulli(p_{i}) $$
$$\log(\frac{p_{i}}{1-p_{i}}) = \beta_0 + \beta_1 GPA_{i} + \beta_2\text{Extracurricular}_{i}+ \beta_3\text{Work Experience}_{i} + \beta_4 \text{Team applied for}_i$$
where $Y_{i}$ is the acceptance of applicant $i$ , X_{i}s are explanatory variables.\newline

<<<<<<< HEAD
The model is realized in R through the `glm` function. Result is shown in table 1. Not surprisingly, we find that GPA and work experiences are all significant at level 0.05. 1 unit increase of GPA is associated with the odds of being admitted increasing by 621%. Similarly, obtaining level 1 working experience will increase the odds of passing phase in by 335%. Most importantly, variable "gender: women" is highly insignificant with p-value 0.8576, which supports the nonexistence of gender bias in the first phase of hiring. Similar thing for the category where applicants are not willing to tell their gender.



## Research Question 2: Is there any gender bias in the remuneration processes?
Black Saber Software provide us with data about promotion and salary for the entire staff. The data we get consists information of the staff including annual salary, gender, job in the company, financial quarter salary, productivity, role seniority, and quality of demonstrated leadership. We use these data to investigate whether there is any gender bias in remuneration process. The general methodology that we use to is creating a boxplot of salary conditions on role seniority and gender setting, and then applying different types of regression models to see which one best serve our purpose. 
Boxplot: 





From the graph, we can see that women have lower salaries across different role seniority.

In order to test whether gender bias truely exists, we need to first find the most appropriate model. We create a simple linear regression model: $$y = x1+x$$, we find out that gender is statistically significant, which suggests gender has impacts on salaries. Moving on from SLR, we apply linear mixed model: $$ y =    $$, we add the variable "team"(job in the company) as the random intercept. We do such because we think there should be variations in salaries across different jobs in the company. The likelihood ratio test tells us including such does explain the data better. The results from the linear mixed model also show us that gender is significant. Next, we add a random slope to the previous model because the effect of the productivity may be different for different jobs in the company. After the likelihood ratio test, we find that slopes are an unnecessary complication to our model. Finally, we add role seniority as another random intercept because there should be variations in the salaries across different role seniority based on our histogram. For example, senior workers have higher salaries than junior workers. The likelihood ratio test tells us that including this random intercept does explain the model better. Thus, the final model is $$     $$. 
$$   $$
Based on interpretation, Woman has lower salary by an average of $\$1758$ than man. This result indicates that there is gender bias in remuneration. 







The model is realized in R through the `glm` function. Result is shown in table 1. Not surprisingly, we find that GPA and work experiences are all significant at level 0.05. Most importantly, variable "gender: women" is highly insignificant with p-value 0.8576, which supports the nonexistence of gender bias in the first phase of hiring. Similar thing for the category where applicants are not willing to tell their gender.

```{r}
## Phase 1 -> Phase 2
## Join Phase 1 and Phase 2, create variable pass_phase1
joint12 <- phase1 %>% left_join(phase2, by= c("applicant_id", "team_applied_for", "cover_letter","cv", "gpa", "gender", "extracurriculars", "work_experience")) %>% mutate(pass_phase1 = ifelse(is.na(technical_skills), 0, 1))

## Draw Contingency Table
table(factor(joint12$team_applied_for), factor(joint12$pass_phase1))

## Visualize Contingency Table
joint12 %>% ggplot() + geom_mosaic(aes(x = product(gender, pass_phase1), fill = gender))

proptable5 <- joint12 %>% group_by(gender, team_applied_for, pass_phase1) %>% summarize(number = n()) %>% group_by(gender, team_applied_for) %>% summarize(pass_phase1 = pass_phase1, ratio = number/sum(number))
ggplot(proptable5, aes(fill = factor(pass_phase1), y = ratio, x = team_applied_for)) + geom_bar(position = "fill", stat = "identity") + facet_grid(. ~ gender)


## Build Mixed Logistic regression model to explain whether or not phase 1 is passed
joint12$team_applied_for <- as.factor(joint12$team_applied_for)
model1 <- glm(pass_phase1 ~ gpa + factor(extracurriculars) + factor(work_experience) + gender
                + team_applied_for, family = "binomial", data = joint12)
summary(model1)
## Calculate CI
ci <- confint(model1)
## Print Result of Regression
table <- cbind(round(exp(summary(model1)$coeff[,1]),2),
               round(exp(ci), 2),
               round(summary(model1)$coeff[,4],4))
colnames(table) <- c("Estimate", "Lower Limit", "Upper Limit", "p-value")
kable(table)
```




### Phase 2 $\rightarrow$ Phase 3
Similarly as the previous phase, we are going to check for gender bias from phase 2 to phase 3. See Figure 3 and 4 for comparison of proportion of passing phase 2 by gender and the team they apply to. In this case, we find little difference between employees that apply to data or software team which is different from the previous phase, which may suggest the insignificance of the team variable. But we still start with building model with this variable. Since applicants that are accepted from phase 1 should go through a series of tests online to check their technical skills, writing skills, our model should focus on these variables.




By conducting logistic regression, we find the algorithm for selecting applicant in phase 2 does not depend much on the significant variables in phase 1 but on the test scores for relevant skills and the selection process is also irrelevant with one's gender.\newline


```{r}
## Phase 2 -> Phase 3
## Join phase2 and phase3 data and create variable pass_phase2
joint23 <- phase2 %>% left_join(phase3, by = "applicant_id") %>% mutate(pass_phase2 = ifelse(is.na(interviewer_rating_1), 0, 1))

## Visualization for exploratory data analysis
proptable2 <- table(factor(joint23$gender), factor(joint23$pass_phase2))
proptable2 <- as.data.frame(prop.table(proptable2, 1))
names(proptable2)[1]=('Gender')
names(proptable2)[2]=('Pass')
names(proptable2)[3]=("Proportion")
ggplot(data=proptable2, aes(x=Gender, y=Proportion, fill=Pass)) + geom_bar(stat="identity") 
joint23 %>% ggplot() + geom_mosaic(aes(x = product(gender, pass_phase2), fill = gender))

proptable3 <- joint23 %>% group_by(gender, team_applied_for, pass_phase2) %>% summarize(number = n()) %>% group_by(gender, team_applied_for) %>% summarize(pass_phase2 = pass_phase2, ratio = number/sum(number))
ggplot(proptable3, aes(fill = factor(pass_phase2), y = ratio, x = team_applied_for)) + geom_bar(position = "fill", stat = "identity")+facet_grid(. ~ gender)

## Build Mixed Logistic regression model to explain whether or not phase 2 is passed
model2 <- glm(pass_phase2 ~ gender + gpa + technical_skills + writing_skills + leadership_presence + speaking_skills + team_applied_for, family = "binomial", data = joint23)
summary(model2)

model3 <- glm(pass_phase2 ~ gender + gpa + technical_skills + writing_skills + leadership_presence + speaking_skills, family = "binomial", data = joint23)
summary(model3)

model4 <- glm(pass_phase2 ~ gender + technical_skills + writing_skills + leadership_presence + speaking_skills, family = "binomial", data = joint23)
summary(model4)

drop_in_dev <- anova(model4, model3, model2, test="Chisq")

## Calculate CI
ci2 <- confint(model2)
## Print Result of Regression
table2 <- cbind(round(exp(summary(model2)$coeff[,1]),2),
               round(exp(ci2), 2),
               round(summary(model2)$coeff[,4],4))
colnames(table2) <- c("Estimate", "Lower Limit", "Upper Limit", "p-value")
kable(table2)

```
### Phase 3 to Final Result
The methodology we use to deal with this phase is different from the first two phases. Since being listed as ‘first’ or ‘second’ interviewer is arbitrary, we create a new variable "sum" that is the sum of ratings by two interviewers.

```{r}
## Phase 3 -> Final Result
final_hire <- final_hire %>% mutate(pass_phase3 = 1)
joint3f <- joint23 %>% filter(is.na(interviewer_rating_1)==FALSE) %>% left_join(final_hire, by = "applicant_id")
joint3f$pass_phase3[is.na(joint3f$pass_phase3)] <- 0 

joint3f %>% ggplot() + geom_mosaic(aes(x = product(gender, pass_phase3), fill = gender))


model5 <- glm(pass_phase_3 ~ gender + interviewer_rating_1:interviewer_rating_2, data = joint3f, family = "binomial")
summary(model5)


joint_3f <- joint3f %>% mutate(sum = interviewer_rating_1+interviewer_rating_2)

sort(joint_3f[
  order(- joint_3f[,17] ),
][1:10, ]$applicant_id)

sort(final_hire$applicant_id)

model5 <- lm(sum ~ technical_skills + writing_skills + leadership_presence + speaking_skills + gender, data = joint_3f)
summary(model5)
```

## Research Question 2: Is there any gender bias in the remuneration processes?
Black Saber Software provide us with data about promotion and salary for the entire staff. The data we get consists information of the staff including annual salary, gender, job in the company, financial quarter salary, productivity, role seniority, and quality of demonstrated leadership. We use these data to investigate whether there is any gender bias in remuneration process. The general methodology that we use to is creating a boxplot of salary conditions on role seniority and gender setting, and then applying different types of regression models to see which one best serve our purpose. 
Boxplot: 



joint3f %>% mutate(mean = mean(interviewer_rating_1, interviewer_rating_2))
```


```{r,include=TRUE, echo=FALSE, warning=FALSE, message=FALSE}
#chunk new created by Peter


black_saber_current_employees %>%
  filter(gender != "Prefer not to say")%>%
  group_by(employee_id)%>%
  ggplot(aes(x = role_seniority, y = salary, color = gender))+
  geom_boxplot()+
  theme_minimal() +
  scale_colour_brewer(palette = "Dark2")+
  theme(legend.position = "right")

cemployees %>% 
  mutate(salary = str_remove_all(cemployees$salary,"[[:punct:]]"))
reg_salary = lmer(salary~productivity+(1|role_seniority), data =cemployees)

## check if salary are fair in gender(gender)
new_cemployees =  cemployees%>%
  mutate(salary = str_remove_all(cemployees$salary,"[[:punct:]]")) %>%
  mutate(salary = as.integer(str_remove_all(cemployees$salary,"[^[:alnum:]]")))

#create a histogram of salary condition on role seniority
new_cemployees %>%
  ggplot(aes(x = salary)) +
  stat_bin(bins = 50)+
  geom_histogram() +
  facet_wrap(~role_seniority, nrow = 3) +
  ggtitle(label="Histogram of salary condition on role seniority") +
  theme_bw() +
  theme(legend.position = "right")


new_cemployees = new_cemployees%>%
  filter(gender!="Prefer not to say")%>%
  mutate(role_seniority = fct_relevel(role_seniority, "Director", after = 7))
new_cemployees = new_cemployees%>%
  mutate(role_seniority = fct_relevel(role_seniority, "Manager", after = 6))

reg_salary_1 = lm(salary~productivity+gender, data =new_cemployees)
reg_salary_2 = lmer(salary~productivity+gender+(1|team), data =new_cemployees)
#lmtest::lrtest(reg_salary_1, reg_salary_2) #check if adding team as random intercept is more significant


new_cemployees =  cemployees%>%
  mutate(salary = str_remove_all(cemployees$salary,"[[:punct:]]")) %>%
  mutate(salary = as.integer(str_remove_all(cemployees$salary,"[^[:alnum:]]")))%>%
  filter(gender!="Prefer not to say")

reg_salary_2a = lmer(salary~productivity+gender+(1+productivity|team), data =new_cemployees)
#lmtest::lrtest(reg_salary_2, reg_salary_2a) #check if there productivity are different for different team


reg_salary_3 = lmer(salary~productivity+gender+(1|team)+(1|role_seniority), data =new_cemployees)
lmtest::lrtest(reg_salary_2, reg_salary_3)#check if role seniority as random intercept(baseline) is more significant


## Calculate CI
ci2 <- confint(reg_salary_3)
## Print Result of Regression
reg_salary <- cbind(round(summary(reg_salary_3)$coeff[,1],2))
rownames(reg_salary) <- c("Intecept","Productivity","GenderWomen")
colnames(reg_salary)=c("Estimates")
kable(reg_salary)

#create a boxplot
new_cemployees %>%
  ggplot(aes(x = role_seniority,
             y = salary,
             color=gender)) +
  geom_boxplot() +
  theme_minimal() +
  ggtitle(label="Salary by role seniority and gender setting") +
  theme(legend.position = "right")
```

```{r}
b = cemployees %>%
  group_by(employee_id)%>%
  count(role_seniority)
colnames(b)[3] ="time_since_promotion" 


new_cemployees %>% 
  ggplot(aes(y = salary, x = productivity,color = gender)) +
  geom_point()+
  geom_line(stat="smooth", method = "lm", formula = 'y~x') +
  facet_grid(~role_seniority) +
  scale_x_continuous(breaks = seq(2,12, by = 4)) +
  scale_fill_brewer(palette = "Dark2")+
  theme(legend.position = "right")+
  theme_minimal()

```
## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

1 unit increase of GPA is associated with the odds of being admitted increasing by 621%. Similarly, obtaining level 1 working experience will increase the odds of passing phase in by 335%.

### Strengths and limitations

\newpage
# Consultant information
## Consultant profiles

**Chengen Dong**. Chengen is a senior consultant with Calabash Brothers Solutions. He specializes in data visualization. Daniel earned his Bachelor of Science, Specialist in Statistics Methods and Practice, from the University of Toronto in 2024.

**Yuxuan Longt**. Yuxuan is a senior consultant with Calabash Brothers Solutions. He specialize in reproducible analysis. Peter earned their Bachelor of Science, Majoring in Statistics from the University of Toronto in 2028.

**Ran Li** Ran is a junior consultant in Calabash Brothers Solutions. She is good at coding with software like R and Python. She specializes in Computer Science. Liran earned her Bachelor of Science, Majoring in Computer Science from the University of Toronto in 2028.

**Peizhe Huang** Peizhe is a senior consultant with Calabash Brothers Solutions. She specializes in Probability Statistics. Peizhe earned their Bachelor of Science, Majoring in Statistics from the University of Toronto in 2022.

## Code of ethical conduct

#### Integrity: We maintained honest with our data and clear communication throughout the working process.

#### Teamwork: We worked together to get the job done.

#### Confidentiality: We maintained clients' condifence at all time

#### Growth: We always pursue professional growth




__Final advice: KNIT EARLY AND OFTEN!__